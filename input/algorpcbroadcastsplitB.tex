\SetKwProg{Function}{function}{}{}
\SetKwProg{Upon}{upon}{}{}
\SetKwProg{Initially}{INITIALLY:}{}{}
\SetKwProg{Safety}{SAFETY:}{}{}
\SetKwProg{Dissemination}{DISSEMINATION:}{}{}

\small

\DontPrintSemicolon
\LinesNumbered

%\begin{multicols}{2}
\Dissemination{}{
  
  \Function{$\RPCBROADCAST(m)$} { %\tcp*[f]{$b_p(m)$}} {
%    $\textup{buffering}(m)$ \;
    $\textup{R-broadcast}(m)$
  }

  \BlankLine
  
  \Upon{$\textup{R-deliver}(m)$} {
    $\textup{buffering}(m)$ \;
    $\textup{RPC-deliver}(m)$
  }

  \BlankLine

  \Function{$\textup{buffering}(m)$}{ 
    \lForEach {$q \in B$} {$B[q] \leftarrow B[q] \cup m$}

    \lForEach{$q \in S$ \textup{\textbf{such that}}
      $S[q] = \langle B_\alpha,\, \_,\, false \rangle$}
    {$B_\alpha \leftarrow B_\alpha \cup m$}

    \lForEach{$q \in S$ \textup{\textbf{such that}}
      $S[q] = \langle\, \_,\,B_\pi,\, true \rangle$}
    {$B_\pi \leftarrow B_\pi \cup m$}

    % \ForEach {$q \in S$} {
    %   \textbf{let} $\langle B_\alpha,\, B_\pi,\, received_\pi \rangle \leftarrow S[q]$ \;
    %   \leIf {$received_\pi$}
    %   {$B_\pi \leftarrow B_\pi \cup m$}
    %   {$B_\alpha \leftarrow B_\alpha \cup m$} 
%    }
  }
}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End:
